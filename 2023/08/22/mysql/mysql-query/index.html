<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content=#222><meta name=generator content="Hexo 6.0.0"><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-next.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32-next.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16-next.png><link rel=mask-icon href=/images/logo.svg color=#222><link rel=stylesheet href=/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CLobster+Two:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><script class=next-config data-name=main type=application/json>{"hostname":"tungsing.cc","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta property=og:type content=article><meta property=og:title content="记录解决MySQL  LEFT JOIN 查询慢"><meta property=og:url content=http://tungsing.cc/2023/08/22/mysql/mysql-query/index.html><meta property=og:site_name content="TungSing&#39;s Blog"><meta property=og:locale content=zh_CN><meta property=og:image content=http://tungsing.cc/images/mysql/mysql.jpg><meta property=og:image content=http://tungsing.cc/images/mysql/query_explain_1.png><meta property=og:image content=http://tungsing.cc/images/mysql/query_explain_1.png><meta property=og:image content=http://tungsing.cc/images/mysql/query_explain_2.png><meta property=article:published_time content=2023-08-22T06:00:53.418Z><meta property=article:modified_time content=2023-08-25T09:38:52.491Z><meta property=article:author content=tungSing><meta property=article:tag content=MySQL><meta name=twitter:card content=summary><meta name=twitter:image content=http://tungsing.cc/images/mysql/mysql.jpg><link rel=canonical href=http://tungsing.cc/2023/08/22/mysql/mysql-query/ ><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://tungsing.cc/2023/08/22/mysql/mysql-query/","path":"2023/08/22/mysql/mysql-query/","title":"记录解决MySQL  LEFT JOIN 查询慢"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>记录解决MySQL LEFT JOIN 查询慢 | TungSing's Blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript><link rel=alternate href=/atom.xml title="TungSing's Blog" type=application/atom+xml></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><p class=site-title>TungSing's Blog</p><i class=logo-line></i></a><p class=site-subtitle itemprop=description>用心记录一切！</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签<span class=badge>70</span></a></li><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>分类<span class=badge>10</span></a></li><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档<span class=badge>55</span></a></li><li class="menu-item menu-item-photos"><a href=/photos/ rel=section><i class="fa fa-image fa-fw"></i>相册</a></li><li class="menu-item menu-item-about"><a href=/about/ rel=section><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-search"><a role=button class=popup-trigger><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-3"><a class=nav-link href=#%E7%8E%AF%E5%A2%83><span class=nav-number>1.</span> <span class=nav-text>环境</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E8%83%8C%E6%99%AF><span class=nav-number>2.</span> <span class=nav-text>背景</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%88%86%E6%9E%90><span class=nav-number>3.</span> <span class=nav-text>分析</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95><span class=nav-number>3.1.</span> <span class=nav-text>创建索引</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#join-buffer-size%E9%85%8D%E7%BD%AE><span class=nav-number>3.2.</span> <span class=nav-text>join_buffer_size配置</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E4%B8%8D%E4%B8%80%E8%87%B4><span class=nav-number>3.3.</span> <span class=nav-text>字段类型不一致</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%AD%97%E6%AE%B5%E5%AD%97%E7%AC%A6%E9%9B%86%E4%B8%8D%E4%B8%80%E8%87%B4><span class=nav-number>3.4.</span> <span class=nav-text>字段字符集不一致</span></a></li></ol></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%80%BB%E7%BB%93><span class=nav-number>4.</span> <span class=nav-text>总结</span></a></li><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%8F%82%E8%80%83><span class=nav-number>5.</span> <span class=nav-text>参考</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><p class=site-author-name itemprop=name>tungSing</p><div class=site-description itemprop=description>多读书多看报</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/ ><span class=site-state-item-count>55</span> <span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/ ><span class=site-state-item-count>10</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/ ><span class=site-state-item-count>70</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class=links-of-author-item><a href=https://github.com/tungsing title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tungsing" rel=noopener target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class=links-of-author-item><a href=https://twitter.com/dongsheng__gao title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;dongsheng__gao" rel=noopener target=_blank><i class="fab fa-twitter fa-fw"></i>Twitter</a></span></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=back-to-top role=button aria-label=返回顶部><i class="fa fa-arrow-up"></i> <span>0%</span></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang=zh-CN><link itemprop=mainEntityOfPage href=http://tungsing.cc/2023/08/22/mysql/mysql-query/ ><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/avatar.gif><meta itemprop=name content=tungSing><meta itemprop=description content=多读书多看报></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="TungSing's Blog"></span><header class=post-header><h1 class=post-title itemprop="name headline">记录解决MySQL LEFT JOIN 查询慢</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i> </span><span class=post-meta-item-text>发表于</span> <time title="创建时间：2023-08-22 06:00:53" itemprop="dateCreated datePublished" datetime=2023-08-22T06:00:53Z>2023-08-22</time> </span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar-check"></i> </span><span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-08-25 09:38:52" itemprop=dateModified datetime=2023-08-25T09:38:52Z>2023-08-25</time> </span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i> </span><span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/database/ itemprop=url rel=index><span itemprop=name>database</span></a></span></span></div></div></header><div class=post-body itemprop=articleBody><p><img src=/images/mysql/mysql.jpg></p><span id=more></span><h3 id=环境><a href=#环境 class=headerlink title=环境></a>环境</h3><ul><li>Linux CentOS7 操作系统</li><li>Mysql5.7</li></ul><h3 id=背景><a href=#背景 class=headerlink title=背景></a>背景</h3><p>在和前端开发人员过页面的时候，发现其中一个页面响应很慢，定位原因是API接口响应要24s左右，这响应速度太慢了。排查后端代码发现涉及到的查询SQL语句是一个简单的左连接查询，按之前的经验不能这么慢呢，所以在SQL IDE中排查。</p><p>先说一下涉及的表，如下：</p><figure class="highlight sql"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br></pre></td><td class=code><pre><span class=line><span class=comment>-- 书架表,数量量：4条</span></span><br><span class=line><span class=keyword>create</span> <span class=keyword>table</span> cdlm_bookshelf</span><br><span class=line>(</span><br><span class=line>    bookshelf_id         <span class=type>varchar</span>(<span class=number>32</span>) <span class=keyword>not</span> <span class=keyword>null</span> comment <span class=string>&#x27;书架唯一标识&#x27;</span>,</span><br><span class=line>    user_id              <span class=type>varchar</span>(<span class=number>32</span>) <span class=keyword>not</span> <span class=keyword>null</span> comment <span class=string>&#x27;用户唯一标识&#x27;</span>,</span><br><span class=line>    resource_id          <span class=type>varchar</span>(<span class=number>32</span>) <span class=keyword>not</span> <span class=keyword>null</span> comment <span class=string>&#x27;资源ID&#x27;</span>,</span><br><span class=line>    resource_type        <span class=type>varchar</span>(<span class=number>16</span>) <span class=keyword>not</span> <span class=keyword>null</span> comment <span class=string>&#x27;资源类型&#x27;</span>,</span><br><span class=line>    resource_name        <span class=type>varchar</span>(<span class=number>512</span>) <span class=keyword>not</span> <span class=keyword>null</span> comment <span class=string>&#x27;资源名称&#x27;</span>,</span><br><span class=line>    cover_id             <span class=type>varchar</span>(<span class=number>32</span>) comment <span class=string>&#x27;资源封面,附件表id&#x27;</span>,</span><br><span class=line>    read_position        <span class=type>varchar</span>(<span class=number>128</span>) comment <span class=string>&#x27;阅读位置&#x27;</span>,</span><br><span class=line>    read_percent         <span class=type>int</span> comment <span class=string>&#x27;阅读百分比(0-100)&#x27;</span>,</span><br><span class=line>    <span class=keyword>primary</span> key (bookshelf_id)</span><br><span class=line>);</span><br><span class=line><span class=comment>-- 附件表，数据量：5136453条</span></span><br><span class=line><span class=keyword>CREATE</span> <span class=keyword>TABLE</span> t_attachment_info (</span><br><span class=line>  attachment_id <span class=type>varchar</span>(<span class=number>40</span>) <span class=keyword>NOT</span> <span class=keyword>NULL</span> COMMENT <span class=string>&#x27;附件id&#x27;</span>,</span><br><span class=line>  attachment_name <span class=type>varchar</span>(<span class=number>2000</span>) <span class=keyword>DEFAULT</span> <span class=keyword>NULL</span> COMMENT <span class=string>&#x27;附件名称&#x27;</span>,</span><br><span class=line>  attachment_type <span class=type>varchar</span>(<span class=number>200</span>) <span class=keyword>DEFAULT</span> <span class=keyword>NULL</span> COMMENT <span class=string>&#x27;附件类型&#x27;</span>,</span><br><span class=line>  attachment_size <span class=keyword>double</span> <span class=keyword>DEFAULT</span> <span class=keyword>NULL</span> COMMENT <span class=string>&#x27;附件大小&#x27;</span>,</span><br><span class=line>  attachment_path <span class=type>varchar</span>(<span class=number>200</span>) <span class=keyword>DEFAULT</span> <span class=keyword>NULL</span> COMMENT <span class=string>&#x27;附件路径(相对)&#x27;</span></span><br><span class=line>  <span class=keyword>PRIMARY</span> KEY (attachment_id)</span><br><span class=line>);</span><br></pre></td></tr></table></figure><p>查询的语句：</p><figure class="highlight sql"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>SELECT</span> b.<span class=operator>*</span>, a.attachment_path <span class=keyword>AS</span> cover_path</span><br><span class=line><span class=keyword>FROM</span> cdlm_bookshelf_test b</span><br><span class=line><span class=keyword>LEFT</span> <span class=keyword>JOIN</span> t_attachment_info a</span><br><span class=line><span class=keyword>ON</span> b.cover_id <span class=operator>=</span> a.attachment_id</span><br><span class=line><span class=keyword>WHERE</span> b.user_id<span class=operator>=</span><span class=string>&#x27;7f52280cbdd04e29ae899884a4a2193a&#x27;</span>;</span><br></pre></td></tr></table></figure><p>查询耗时，10.3秒左右：</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre></td><td class=code><pre><span class=line>1 queries executed, 1 success, 0 errors, 0 warnings</span><br><span class=line></span><br><span class=line>查询：SELECT b.*, a.attachment_path AS cover_path FROM cdlm_bookshelf_test b left JOIN t_attachment_info a ON b.cover_id = a.attachmen...</span><br><span class=line></span><br><span class=line>共 5 行受到影响</span><br><span class=line></span><br><span class=line>执行耗时   : 10.318 sec</span><br><span class=line>传送时间   : 0 sec</span><br><span class=line>总耗时      : 10.318 sec</span><br><span class=line></span><br></pre></td></tr></table></figure><h3 id=分析><a href=#分析 class=headerlink title=分析></a>分析</h3><p>首先想到的肯定是用<code>EXPLAIN</code> 关键词分析执行情况，结果如下：</p><p><img src=/images/mysql/query_explain_1.png></p><p>通过对执行计划结果的分析<code>t_attachment_info</code>表是全表扫描呀，这肯定慢。对照我们的查询语句，为什么是全表扫描没用到索引呢? <code>t_attachment_info</code>表中的<code>attachment_id</code> 是主键，有主键索引。那就是<code>cdlm_bookshelf_test</code> 表中的<code>cover_id</code> 没用索引导致的了，那我们就给创建个索引试试。</p><h4 id=创建索引><a href=#创建索引 class=headerlink title=创建索引></a>创建索引</h4><p>给<code>cdlm_bookshelf_test</code> 表中的<code>cover_id</code> 创建索引</p><figure class="highlight sql"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>ALTER</span> <span class=keyword>TABLE</span> cdlm_bookshelf_test</span><br><span class=line>  <span class=keyword>ADD</span> INDEX idx_cover_Id (cover_id);</span><br></pre></td></tr></table></figure><p>验证一下效果，结果花了11.3秒左右，更慢了，这是啥情况呢？继续用<code>EXPLAIN</code> 分析执行情况</p><p><img src=/images/mysql/query_explain_1.png></p><p>从执行计划结果看，没啥变化呢？但是我看到<code>join buffer</code> 。难道是配置的问题？那就查看并配置一下<code>join_buffer_size</code>。</p><h4 id=join-buffer-size配置><a href=#join-buffer-size配置 class=headerlink title=join_buffer_size配置></a>join_buffer_size配置</h4><p>查看MySQL的配置，之前并没有配置<code>join_buffer_size</code>的值，那就是使用的默认值。那我们给她配置一个大一点值，再观察下效果。</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line># myslq 配置文件</span><br><span class=line>join_buffer_size=2M</span><br></pre></td></tr></table></figure><p>结果，查询数据时间确实变短了，现在5-6秒了，但这也很慢，同样查看执行计划，一样没变化。</p><p>我又找个一个之前的左连接查询语句，速度很快。所以这个参数确实能提升查询速度，但不是该语句慢的核心原因。到这我只能利用搜索引擎了。</p><h4 id=字段类型不一致><a href=#字段类型不一致 class=headerlink title=字段类型不一致></a>字段类型不一致</h4><p>查询到一篇文章的情况是，左连接关联的字段的类型不一致导致查询很慢。字段类型不一致数据库会先做类型转换再去关联查询，所以就慢。而我的查询语句关联字段类型是一致，都是<code>varchar</code>,只是长度是不一样的。难道是这样原因？修改<code>cdlm_bookshelf_test</code> 表中的<code>cover_id</code> 字段的长度也是<code>40</code></p><figure class="highlight sql"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>ALTER</span> <span class=keyword>TABLE</span> cdlm_bookshelf_test</span><br><span class=line>  CHANGE cover_id cover_id <span class=type>VARCHAR</span> (<span class=number>40</span>)  <span class=keyword>NULL</span> COMMENT <span class=string>&#x27;资源封面,附件表id&#x27;</span>;</span><br></pre></td></tr></table></figure><p>结果没啥变化。说明字段的长度不是影响因素。继续</p><h4 id=字段字符集不一致><a href=#字段字符集不一致 class=headerlink title=字段字符集不一致></a>字段字符集不一致</h4><p>另一篇文章提到了，字段字符集不一致，也会导致查询慢。赶紧查看了所涉及的表的字符集是否不一致。</p><p>果然表的字符集是不一样的。</p><p><code>t_attachment_info</code>是<code>utf-8</code>，而<code>cdlm_bookshelf_test</code>是<code>utf8mb4</code>。</p><p>导致表的字符集不一致的原因是，<code>cdlm_bookshelf_test</code>是新创建的，而<code>t_attachment_info</code>表是从旧系统导入进来的，这是历史原因了。那赶紧动手先修改字符集使其保持一致。</p><figure class="highlight sql"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line><span class=comment>-- 先修改表</span></span><br><span class=line><span class=keyword>ALTER</span> <span class=keyword>TABLE</span> cdlm_bookshelf_test</span><br><span class=line>  CHARSET <span class=operator>=</span> utf8;</span><br><span class=line></span><br><span class=line><span class=comment>-- 修改字段</span></span><br><span class=line><span class=keyword>alter</span> <span class=keyword>table</span> cdlm_bookshelf_test <span class=keyword>convert</span> <span class=keyword>to</span> <span class=type>character</span> <span class=keyword>set</span> utf8;</span><br><span class=line></span><br></pre></td></tr></table></figure><p>查询验证，只需要0.008秒。这才是正常的速度!</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre></td><td class=code><pre><span class=line>1 queries executed, 1 success, 0 errors, 0 warnings</span><br><span class=line></span><br><span class=line>查询：SELECT b.*, a.attachment_path AS cover_path FROM cdlm_bookshelf_test b left JOIN t_attachment_info a ON b.cover_id = a.attachmen...</span><br><span class=line></span><br><span class=line>共 5 行受到影响</span><br><span class=line></span><br><span class=line>执行耗时   : 0.008 sec</span><br><span class=line>传送时间   : 0 sec</span><br><span class=line>总耗时      : 0.008 sec</span><br></pre></td></tr></table></figure><p>再看一下执行计划：</p><p><img src=/images/mysql/query_explain_2.png></p><p>利用了eq_ref，只是对主键或者唯一索引的扫描，只读取了一行数据。</p><h3 id=总结><a href=#总结 class=headerlink title=总结></a>总结</h3><p>本文主要是记录影响MySQL left join 查询慢的点，有索引、join_buffer_size、关联字段类型、字段字符集。先记录这些点，慢慢的可以深入其内部的工作原理，了解和掌握更多知识。</p><h3 id=参考><a href=#参考 class=headerlink title=参考></a>参考</h3><p><a target=_blank rel=noopener href=https://xie.infoq.cn/article/8aa2cd409dff1d9d190bba937>MySQL 性能优化：EXPLAIN 执行计划与 join</a></p><p><a target=_blank rel=noopener href=https://blog.51cto.com/u_15054039/4267591>mysql left join优化 left join查询慢</a></p></div><footer class=post-footer><div class=post-tags><a href=/tags/MySQL/ rel=tag># MySQL</a></div><div class=post-nav><div class=post-nav-item><a href=/2023/07/17/my/covid-19/ rel=prev title=感染新冠(2023-06-09)><i class="fa fa-chevron-left"></i> 感染新冠(2023-06-09)</a></div><div class=post-nav-item><a href=/2024/01/08/my/2023/ rel=next title=回顾2023>回顾2023 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy; <span itemprop=copyrightYear>2024</span> <span class=with-love><i class="fa fa-user"></i> </span><span class=author itemprop=copyrightHolder>tungSing</span></div></div></footer><script src=https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/next-boot.js></script><script src=/js/pjax.js></script><script src=https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin=anonymous></script><script src=/js/third-party/search/local-search.js></script><script src=/js/third-party/fancybox.js></script><script src=/js/third-party/photo/lazyload.js></script><script src=/js/third-party/photo/minigrid.min.js></script><script data-pjax src=/js/third-party/photo/photo.js></script></body></html>