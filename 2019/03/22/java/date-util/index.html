<!DOCTYPE html><html lang=zh-CN><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content=#222><meta name=generator content="Hexo 6.0.0"><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon-next.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32-next.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16-next.png><link rel=mask-icon href=/images/logo.svg color=#222><link rel=stylesheet href=/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CLobster+Two:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><script class=next-config data-name=main type=application/json>{"hostname":"tungsing.cc","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src=/js/config.js></script><meta name=description content="前言 之前就看资料说SimpleDateFormat是线程不安全的，正好框架里面有自己的DataUtils类，正好优化并学习一下  环境jdk1.7"><meta property=og:type content=article><meta property=og:title content=DataUtils工具类优化><meta property=og:url content=http://tungsing.cc/2019/03/22/java/date-util/index.html><meta property=og:site_name content="TungSing&#39;s Blog"><meta property=og:description content="前言 之前就看资料说SimpleDateFormat是线程不安全的，正好框架里面有自己的DataUtils类，正好优化并学习一下  环境jdk1.7"><meta property=og:locale content=zh_CN><meta property=article:published_time content=2019-03-22T02:25:45.542Z><meta property=article:modified_time content=2023-03-20T10:04:46.414Z><meta property=article:author content=TungSing><meta property=article:tag content=java><meta property=article:tag content=SimpleDateFormat><meta property=article:tag content=thread><meta name=twitter:card content=summary><link rel=canonical href=http://tungsing.cc/2019/03/22/java/date-util/ ><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://tungsing.cc/2019/03/22/java/date-util/","path":"2019/03/22/java/date-util/","title":"DataUtils工具类优化"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>DataUtils工具类优化 | TungSing's Blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript><link rel=alternate href=/atom.xml title="TungSing's Blog" type=application/atom+xml></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><p class=site-title>TungSing's Blog</p><i class=logo-line></i></a><p class=site-subtitle itemprop=description>用心记录一切！</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签<span class=badge>71</span></a></li><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>分类<span class=badge>10</span></a></li><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档<span class=badge>57</span></a></li><li class="menu-item menu-item-photos"><a href=/photos/ rel=section><i class="fa fa-image fa-fw"></i>相册</a></li><li class="menu-item menu-item-about"><a href=/about/ rel=section><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-search"><a role=button class=popup-trigger><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%89%8D%E8%A8%80><span class=nav-number>1.</span> <span class=nav-text>前言</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E7%8E%AF%E5%A2%83><span class=nav-number>2.</span> <span class=nav-text>环境</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E4%B8%AD%E4%BB%A3%E7%A0%81><span class=nav-number>3.</span> <span class=nav-text>测试框架中代码</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E9%94%99%E8%AF%AF%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90><span class=nav-number>4.</span> <span class=nav-text>错误原因分析</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95><span class=nav-number>5.</span> <span class=nav-text>解决办法</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E4%BC%98%E5%8C%96%E6%A1%86%E6%9E%B6%E4%BB%A3%E7%A0%81><span class=nav-number>6.</span> <span class=nav-text>优化框架代码</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E7%BB%93%E8%AF%AD><span class=nav-number>7.</span> <span class=nav-text>结语</span></a></li><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%8F%82%E8%80%83><span class=nav-number>8.</span> <span class=nav-text>参考</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><p class=site-author-name itemprop=name>TungSing</p><div class=site-description itemprop=description>多读书多看报</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/ ><span class=site-state-item-count>57</span> <span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/ ><span class=site-state-item-count>10</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/ ><span class=site-state-item-count>71</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class=links-of-author-item><a href=https://github.com/tungsing title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tungsing" rel=noopener target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class=links-of-author-item><a href=mailto:dsh.gao@gmail.com title="E-Mail → mailto:dsh.gao@gmail.com" rel=noopener target=_blank><i class="fa fa-envelope fa-fw"></i>E-Mail</a> </span><span class=links-of-author-item><a href=https://twitter.com/dongsheng__gao title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;dongsheng__gao" rel=noopener target=_blank><i class="fab fa-twitter fa-fw"></i>Twitter</a> </span><span class=links-of-author-item><a href=https://t.me/tungsing_gao title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;tungsing_gao" rel=noopener target=_blank><i class="fab fa-telegram fa-fw"></i>Telegram</a></span></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=back-to-top role=button aria-label=返回顶部><i class="fa fa-arrow-up"></i> <span>0%</span></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang=zh-CN><link itemprop=mainEntityOfPage href=http://tungsing.cc/2019/03/22/java/date-util/ ><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content=/images/avatar.gif><meta itemprop=name content=TungSing><meta itemprop=description content=多读书多看报></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="TungSing's Blog"></span><header class=post-header><h1 class=post-title itemprop="name headline">DataUtils工具类优化</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i> </span><span class=post-meta-item-text>发表于</span> <time title="创建时间：2019-03-22 02:25:45" itemprop="dateCreated datePublished" datetime=2019-03-22T02:25:45Z>2019-03-22</time> </span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar-check"></i> </span><span class=post-meta-item-text>更新于</span> <time title="修改时间：2023-03-20 10:04:46" itemprop=dateModified datetime=2023-03-20T10:04:46Z>2023-03-20</time> </span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i> </span><span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/java/ itemprop=url rel=index><span itemprop=name>java</span></a></span></span></div></div></header><div class=post-body itemprop=articleBody><h4 id=前言><a href=#前言 class=headerlink title=前言></a>前言</h4><blockquote><p>之前就看资料说SimpleDateFormat是线程不安全的，正好框架里面有自己的DataUtils类，正好优化并学习一下</p></blockquote><h4 id=环境><a href=#环境 class=headerlink title=环境></a>环境</h4><p>jdk1.7</p><span id=more></span><h4 id=测试框架中代码><a href=#测试框架中代码 class=headerlink title=测试框架中代码></a>测试框架中代码</h4><p>开20个线程去格式日期</p><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br></pre></td><td class=code><pre><span class=line><span class=function><span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class=title>main</span><span class=params>(String[] args)</span> <span class=keyword>throws</span> InterruptedException </span>&#123;</span><br><span class=line>    ExecutorService service = Executors.newFixedThreadPool(<span class=number>100</span>);</span><br><span class=line>    <span class=comment>// 开启20个线程</span></span><br><span class=line>    <span class=keyword>for</span> (<span class=keyword>int</span> i = <span class=number>0</span>; i &lt; <span class=number>20</span>; i++) &#123;</span><br><span class=line>        service.execute(<span class=keyword>new</span> Runnable() &#123;</span><br><span class=line></span><br><span class=line>            <span class=meta>@Override</span></span><br><span class=line>            <span class=function><span class=keyword>public</span> <span class=keyword>void</span> <span class=title>run</span><span class=params>()</span> </span>&#123;</span><br><span class=line>                <span class=keyword>for</span> (<span class=keyword>int</span> j = <span class=number>0</span>; j &lt; <span class=number>10</span>; j++) &#123;</span><br><span class=line>                    System.out.println(DateUtils.parseDate(<span class=string>&quot;2019-03-22 10:03:25&quot;</span>));</span><br><span class=line>                &#125;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;);</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    service.shutdown();</span><br><span class=line>    service.awaitTermination(<span class=number>1</span>, TimeUnit.DAYS);</span><br><span class=line></span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>运行结果</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br><span class=line>93</span><br><span class=line>94</span><br><span class=line>95</span><br><span class=line>96</span><br><span class=line>97</span><br><span class=line>98</span><br><span class=line>99</span><br><span class=line>100</span><br><span class=line>101</span><br><span class=line>102</span><br><span class=line>103</span><br><span class=line>104</span><br><span class=line>105</span><br><span class=line>106</span><br><span class=line>107</span><br><span class=line>108</span><br><span class=line>109</span><br><span class=line>110</span><br><span class=line>111</span><br><span class=line>112</span><br><span class=line>113</span><br><span class=line>114</span><br><span class=line>115</span><br><span class=line>116</span><br><span class=line>117</span><br><span class=line>118</span><br><span class=line>119</span><br><span class=line>120</span><br><span class=line>121</span><br><span class=line>122</span><br><span class=line>123</span><br><span class=line>124</span><br><span class=line>125</span><br><span class=line>126</span><br><span class=line>127</span><br><span class=line>128</span><br><span class=line>129</span><br><span class=line>130</span><br><span class=line>131</span><br><span class=line>132</span><br><span class=line>133</span><br><span class=line>134</span><br><span class=line>135</span><br><span class=line>136</span><br><span class=line>137</span><br><span class=line>138</span><br><span class=line>139</span><br><span class=line>140</span><br><span class=line>141</span><br><span class=line>142</span><br><span class=line>143</span><br><span class=line>144</span><br><span class=line>145</span><br><span class=line>146</span><br><span class=line>147</span><br><span class=line>148</span><br><span class=line>149</span><br><span class=line>150</span><br><span class=line>151</span><br><span class=line>152</span><br><span class=line>153</span><br><span class=line>154</span><br><span class=line>155</span><br><span class=line>156</span><br><span class=line>157</span><br><span class=line>158</span><br><span class=line>159</span><br><span class=line>160</span><br><span class=line>161</span><br><span class=line>162</span><br><span class=line>163</span><br><span class=line>164</span><br><span class=line>165</span><br><span class=line>166</span><br><span class=line>167</span><br></pre></td><td class=code><pre><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Sun Mar 01 10:03:25 CST 1970</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>java.lang.NumberFormatException: For input string: &quot;33E&quot;</span><br><span class=line>    at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)</span><br><span class=line>    at java.lang.Long.parseLong(Long.java:419)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at java.lang.Long.parseLong(Long.java:468)Thu Jan 01 00:03:25 CST 1970</span><br><span class=line></span><br><span class=line>    at java.text.DigitList.getLong(DigitList.java:177)</span><br><span class=line>    at java.text.DecimalFormat.parse(DecimalFormat.java:1297)</span><br><span class=line>    at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:1934)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:1311)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at java.text.DateFormat.parse(DateFormat.java:335)</span><br><span class=line>    at com.resoft.original.framework.common.OriginalDateUtils.parseDate(OriginalDateUtils.java:275)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at com.resoft.original.framework.common.Test$1.run(Test.java:35)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)</span><br><span class=line></span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019    at java.lang.Thread.run(Thread.java:662)</span><br><span class=line></span><br><span class=line>null</span><br><span class=line>java.lang.NumberFormatException: For input string: &quot;&quot;Tue Jan 01 00:03:25 CST 2019</span><br><span class=line></span><br><span class=line>    at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)Thu Jan 22 10:03:25 CST 1970</span><br><span class=line></span><br><span class=line>    at java.lang.Long.parseLong(Long.java:431)</span><br><span class=line>Wed Dec 31 00:00:00 CST 1969</span><br><span class=line>    at java.lang.Long.parseLong(Long.java:468)</span><br><span class=line>    at java.text.DigitList.getLong(DigitList.java:177)</span><br><span class=line>Tue Jan 01 00:03:25 CST 2019</span><br><span class=line>    at java.text.DecimalFormat.parse(DecimalFormat.java:1297)</span><br><span class=line>    at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:1589)</span><br><span class=line>Tue Jan 01 00:03:25 CST 2019</span><br><span class=line>    at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:1311)</span><br><span class=line>    at java.text.DateFormat.parse(DateFormat.java:335)Thu Jan 22 00:00:25 CST 1970</span><br><span class=line></span><br><span class=line>    at com.resoft.original.framework.common.OriginalDateUtils.parseDate(OriginalDateUtils.java:275)</span><br><span class=line>    at com.resoft.original.framework.common.Test$1.run(Test.java:35)</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)</span><br><span class=line>Tue Jan 01 00:00:25 CST 2019    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)</span><br><span class=line></span><br><span class=line>Thu Jan 01 00:44:40 CST 1970</span><br><span class=line>    at java.lang.Thread.run(Thread.java:662)</span><br><span class=line>Tue Jan 01 03:03:25 CST 2019</span><br><span class=line>nulljava.lang.NumberFormatException: For input string: &quot;&quot;</span><br><span class=line></span><br><span class=line>    at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)</span><br><span class=line>    at java.lang.Long.parseLong(Long.java:431)</span><br><span class=line>Thu Jan 01 00:00:25 CST 1970</span><br><span class=line>    at java.lang.Long.parseLong(Long.java:468)</span><br><span class=line>    at java.text.DigitList.getLong(DigitList.java:177)</span><br><span class=line>    at java.text.DecimalFormat.parse(DecimalFormat.java:1297)</span><br><span class=line>    at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:1589)</span><br><span class=line>    at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:1311)</span><br><span class=line>    at java.text.DateFormat.parse(DateFormat.java:335)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at com.resoft.original.framework.common.OriginalDateUtils.parseDate(OriginalDateUtils.java:275)</span><br><span class=line>    at com.resoft.original.framework.common.Test$1.run(Test.java:35)</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)</span><br><span class=line>    at java.lang.Thread.run(Thread.java:662)</span><br><span class=line>java.lang.NumberFormatException: multiple pointsnull</span><br><span class=line></span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at sun.misc.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:1082)</span><br><span class=line>    at java.lang.Double.parseDouble(Double.java:510)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at java.text.DigitList.getDouble(DigitList.java:151)</span><br><span class=line>    at java.text.DecimalFormat.parse(DecimalFormat.java:1302)</span><br><span class=line>    at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:1934)</span><br><span class=line>    at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:1311)</span><br><span class=line>Thu Jul 10 10:03:25 CST 5881580</span><br><span class=line>    at java.text.DateFormat.parse(DateFormat.java:335)</span><br><span class=line>    at com.resoft.original.framework.common.OriginalDateUtils.parseDate(OriginalDateUtils.java:275)</span><br><span class=line>    at com.resoft.original.framework.common.Test$1.run(Test.java:35)</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)</span><br><span class=line>    at java.lang.Thread.run(Thread.java:662)</span><br><span class=line>null</span><br><span class=line>java.lang.NumberFormatException: multiple points</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019    at sun.misc.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:1082)</span><br><span class=line></span><br><span class=line>    at java.lang.Double.parseDouble(Double.java:510)</span><br><span class=line>    at java.text.DigitList.getDouble(DigitList.java:151)Fri Mar 22 10:03:25 CST 2019</span><br><span class=line></span><br><span class=line>    at java.text.DecimalFormat.parse(DecimalFormat.java:1302)</span><br><span class=line>    at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:1934)</span><br><span class=line>    at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:1311)</span><br><span class=line>    at java.text.DateFormat.parse(DateFormat.java:335)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at com.resoft.original.framework.common.OriginalDateUtils.parseDate(OriginalDateUtils.java:275)</span><br><span class=line>    at com.resoft.original.framework.common.Test$1.run(Test.java:35)</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)</span><br><span class=line></span><br><span class=line>......</span><br><span class=line></span><br><span class=line>java.lang.NumberFormatException: For input string: &quot;1.01&quot;</span><br><span class=line>    at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)</span><br><span class=line>    at java.lang.Long.parseLong(Long.java:419)</span><br><span class=line>    at java.lang.Long.parseLong(Long.java:468)</span><br><span class=line>    at java.text.DigitList.getLong(DigitList.java:177)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at java.text.DecimalFormat.parse(DecimalFormat.java:1297)</span><br><span class=line>    at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:1934)</span><br><span class=line>    at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:1311)</span><br><span class=line>    at java.text.DateFormat.parse(DateFormat.java:335)</span><br><span class=line>    at com.resoft.original.framework.common.OriginalDateUtils.parseDate(OriginalDateUtils.java:275)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at com.resoft.original.framework.common.Test$1.run(Test.java:35)</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)</span><br><span class=line>    at java.lang.Thread.run(Thread.java:662)</span><br><span class=line>null</span><br><span class=line>java.lang.NumberFormatException: For input string: &quot;&quot;</span><br><span class=line>    at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)</span><br><span class=line>    at java.lang.Long.parseLong(Long.java:431)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at java.lang.Long.parseLong(Long.java:468)</span><br><span class=line>    at java.text.DigitList.getLong(DigitList.java:177)</span><br><span class=line>    at java.text.DecimalFormat.parse(DecimalFormat.java:1297)</span><br><span class=line>    at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:1934)</span><br><span class=line>    at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:1311)</span><br><span class=line>    at java.text.DateFormat.parse(DateFormat.java:335)</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>    at com.resoft.original.framework.common.OriginalDateUtils.parseDate(OriginalDateUtils.java:275)</span><br><span class=line>    at com.resoft.original.framework.common.Test$1.run(Test.java:35)</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)</span><br><span class=line>    at java.lang.Thread.run(Thread.java:662)</span><br><span class=line>null</span><br><span class=line>java.lang.NumberFormatException: For input string: &quot;&quot;</span><br><span class=line>    at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)</span><br><span class=line>    at java.lang.Long.parseLong(Long.java:431)</span><br><span class=line>    at java.lang.Long.parseLong(Long.java:468)</span><br><span class=line>    at java.text.DigitList.getLong(DigitList.java:177)</span><br><span class=line>    at java.text.DecimalFormat.parse(DecimalFormat.java:1297)</span><br><span class=line>    at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:1589)</span><br><span class=line>    at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:1311)</span><br><span class=line>    at java.text.DateFormat.parse(DateFormat.java:335)</span><br><span class=line>    at com.resoft.original.framework.common.OriginalDateUtils.parseDate(OriginalDateUtils.java:275)</span><br><span class=line>    at com.resoft.original.framework.common.Test$1.run(Test.java:35)</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)</span><br><span class=line>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)</span><br><span class=line>    at java.lang.Thread.run(Thread.java:662)</span><br><span class=line>null</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br></pre></td></tr></table></figure><p>分析错误日志有如下错误</p><ul><li>会出现日期不对的情况</li><li>java.lang.NumberFormatException: For input string xxx</li><li>java.lang.NumberFormatException: multiple points</li></ul><h4 id=错误原因分析><a href=#错误原因分析 class=headerlink title=错误原因分析></a>错误原因分析</h4><p>首先看代码是如何写的</p><figure class="highlight java"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre></td><td class=code><pre><span class=line><span class=keyword>private</span> <span class=keyword>static</span> Map&lt;DateFormat, SimpleDateFormat&gt; dateFormaters = <span class=keyword>new</span> HashMap&lt;DateFormat, SimpleDateFormat&gt;(<span class=number>3</span>, <span class=number>0.2f</span>);</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>private</span> <span class=keyword>static</span> SimpleDateFormat <span class=title>getDateFormater</span><span class=params>(DateFormat format)</span> </span>&#123;</span><br><span class=line>    SimpleDateFormat dateFormater = <span class=keyword>null</span>;</span><br><span class=line></span><br><span class=line>    <span class=keyword>if</span> ((dateFormater = dateFormaters.get(format)) == <span class=keyword>null</span>) &#123;</span><br><span class=line>        dateFormater = <span class=keyword>new</span> SimpleDateFormat(format.format);</span><br><span class=line>        dateFormaters.put(format, dateFormater);</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    <span class=keyword>return</span> dateFormater;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>static</span> java.util.<span class=function>Date <span class=title>parseDate</span><span class=params>(String dateStr)</span> </span>&#123;</span><br><span class=line>    <span class=keyword>return</span> getDateFormater(DateFormat.YMDHMS_HYPHEN).parse(</span><br><span class=line>                            dateStr);</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p><strong>DateFormat</strong>是枚举，定义了各种日期格式<br>代码本质还是获取一个 <strong>静态</strong> 的 <strong>SimpleDateFormat</strong> 对象，引入Map是为了提高效率。<br>那么在多线程的情况下SimpleDateFormat对象实例就会 <strong>被多个线程共享</strong> ，通过看源码找原因</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br><span class=line>55</span><br><span class=line>56</span><br><span class=line>57</span><br><span class=line>58</span><br><span class=line>59</span><br><span class=line>60</span><br><span class=line>61</span><br><span class=line>62</span><br><span class=line>63</span><br><span class=line>64</span><br><span class=line>65</span><br><span class=line>66</span><br><span class=line>67</span><br><span class=line>68</span><br><span class=line>69</span><br><span class=line>70</span><br><span class=line>71</span><br><span class=line>72</span><br><span class=line>73</span><br><span class=line>74</span><br><span class=line>75</span><br><span class=line>76</span><br><span class=line>77</span><br><span class=line>78</span><br><span class=line>79</span><br><span class=line>80</span><br><span class=line>81</span><br><span class=line>82</span><br><span class=line>83</span><br><span class=line>84</span><br><span class=line>85</span><br><span class=line>86</span><br><span class=line>87</span><br><span class=line>88</span><br><span class=line>89</span><br><span class=line>90</span><br><span class=line>91</span><br><span class=line>92</span><br></pre></td><td class=code><pre><span class=line>public Date parse(String text, ParsePosition pos) &#123;</span><br><span class=line></span><br><span class=line>    checkNegativeNumberExpression();</span><br><span class=line></span><br><span class=line>    int start = pos.index;</span><br><span class=line>    int oldStart = start;</span><br><span class=line>    int textLength = text.length();</span><br><span class=line></span><br><span class=line>    calendar.clear(); // Clears all the time fields</span><br><span class=line></span><br><span class=line>    boolean[] ambiguousYear = &#123; false &#125;;</span><br><span class=line></span><br><span class=line>    for (int i = 0; i &lt; compiledPattern.length;) &#123;</span><br><span class=line>        int tag = compiledPattern[i] &gt;&gt;&gt; 8;</span><br><span class=line>        int count = compiledPattern[i++] &amp; 0xff;</span><br><span class=line>        if (count == 255) &#123;</span><br><span class=line>            count = compiledPattern[i++] &lt;&lt; 16;</span><br><span class=line>            count |= compiledPattern[i++];</span><br><span class=line>        &#125;</span><br><span class=line></span><br><span class=line>        switch (tag) &#123;</span><br><span class=line>        case TAG_QUOTE_ASCII_CHAR:</span><br><span class=line>            if (start &gt;= textLength || text.charAt(start) != (char) count) &#123;</span><br><span class=line>                pos.index = oldStart;</span><br><span class=line>                pos.errorIndex = start;</span><br><span class=line>                return null;</span><br><span class=line>            &#125;</span><br><span class=line>            start++;</span><br><span class=line>            break;</span><br><span class=line></span><br><span class=line>        case TAG_QUOTE_CHARS:</span><br><span class=line>            while (count-- &gt; 0) &#123;</span><br><span class=line>                if (start &gt;= textLength || text.charAt(start) != compiledPattern[i++]) &#123;</span><br><span class=line>                    pos.index = oldStart;</span><br><span class=line>                    pos.errorIndex = start;</span><br><span class=line>                    return null;</span><br><span class=line>                &#125;</span><br><span class=line>                start++;</span><br><span class=line>            &#125;</span><br><span class=line>            break;</span><br><span class=line></span><br><span class=line>        default:</span><br><span class=line>            boolean obeyCount = false;</span><br><span class=line>            boolean useFollowingMinusSignAsDelimiter = false;</span><br><span class=line></span><br><span class=line>            if (i &lt; compiledPattern.length) &#123;</span><br><span class=line>                int nextTag = compiledPattern[i] &gt;&gt;&gt; 8;</span><br><span class=line>                if (!(nextTag == TAG_QUOTE_ASCII_CHAR || nextTag == TAG_QUOTE_CHARS)) &#123;</span><br><span class=line>                    obeyCount = true;</span><br><span class=line>                &#125;</span><br><span class=line></span><br><span class=line>                if (hasFollowingMinusSign &amp;&amp; (nextTag == TAG_QUOTE_ASCII_CHAR || nextTag == TAG_QUOTE_CHARS)) &#123;</span><br><span class=line>                    int c;</span><br><span class=line>                    if (nextTag == TAG_QUOTE_ASCII_CHAR) &#123;</span><br><span class=line>                        c = compiledPattern[i] &amp; 0xff;</span><br><span class=line>                    &#125; else &#123;</span><br><span class=line>                        c = compiledPattern[i + 1];</span><br><span class=line>                    &#125;</span><br><span class=line></span><br><span class=line>                    if (c == minusSign) &#123;</span><br><span class=line>                        useFollowingMinusSignAsDelimiter = true;</span><br><span class=line>                    &#125;</span><br><span class=line>                &#125;</span><br><span class=line>            &#125;</span><br><span class=line>            start = subParse(text, start, tag, count, obeyCount, ambiguousYear, pos, useFollowingMinusSignAsDelimiter);</span><br><span class=line>            if (start &lt; 0) &#123;</span><br><span class=line>                pos.index = oldStart;</span><br><span class=line>                return null;</span><br><span class=line>            &#125;</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    pos.index = start;</span><br><span class=line>    Date parsedDate;</span><br><span class=line>    try &#123;</span><br><span class=line>        if (ambiguousYear[0]) &#123;</span><br><span class=line>            Calendar savedCalendar = (Calendar) calendar.clone();</span><br><span class=line>            parsedDate = calendar.getTime();</span><br><span class=line>            if (parsedDate.before(defaultCenturyStart)) &#123;</span><br><span class=line>                savedCalendar.set(Calendar.YEAR, defaultCenturyStartYear + 100);</span><br><span class=line>                parsedDate = savedCalendar.getTime();</span><br><span class=line>            &#125;</span><br><span class=line>        &#125; else</span><br><span class=line>            parsedDate = calendar.getTime();</span><br><span class=line>    &#125; catch (IllegalArgumentException e) &#123;</span><br><span class=line>        pos.errorIndex = start;</span><br><span class=line>        pos.index = oldStart;</span><br><span class=line>        return null;</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    return parsedDate;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>重点关注 <strong>calendar.clear()</strong> , <strong>calendar.getTime()</strong> 方法，SimpleDateFormat的parse方法实际操作的就是 <strong>Calendar</strong> 。</p><p>因为我们声明SimpleDateFormat为static变量，那么它的Calendar变量也就是一个共享变量，可以被多个线程访问。</p><p>假设线程A执行完calendar.clear()方法，这时候被挂起，线程B获得CPU执行权。线程B执行到了calendar.getTime()方法就获取到空值了，而这就是引发问题的根源，出现时间不对，线程挂死等等。</p><p><strong>其实SimpleDateFormat源码上作者也给过我们提示：</strong></p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br></pre></td><td class=code><pre><span class=line> * &lt;h4&gt;&lt;a name=&quot;synchronization&quot;&gt;Synchronization&lt;/a&gt;&lt;/h4&gt;</span><br><span class=line> *</span><br><span class=line> * &lt;p&gt;</span><br><span class=line> * Date formats are not synchronized.</span><br><span class=line> * 日期格式不同步。</span><br><span class=line> * It is recommended to create separate format instances for each thread.</span><br><span class=line> * 建议为每个线程创建单独的格式实例。</span><br><span class=line> * If multiple threads access a format concurrently, it must be synchronized</span><br><span class=line> * externally.</span><br><span class=line> * 如果多个线程同时访问一种格式，则必须在外部同步该格式。</span><br><span class=line> *</span><br><span class=line> * @see          &lt;a href=&quot;http://java.sun.com/docs/books/tutorial/i18n/format/simpleDateFormat.html&quot;&gt;Java Tutorial&lt;/a&gt;</span><br><span class=line> * @see          java.util.Calendar</span><br><span class=line> * @see          java.util.TimeZone</span><br><span class=line> * @see          DateFormat</span><br><span class=line> * @see          DateFormatSymbols</span><br><span class=line> * @version      %I%, %G% </span><br><span class=line> * @author       Mark Davis, Chen-Lieh Huang, Alan Liu</span><br><span class=line> */</span><br><span class=line>public class SimpleDateFormat extends DateFormat &#123;</span><br></pre></td></tr></table></figure><h4 id=解决办法><a href=#解决办法 class=headerlink title=解决办法></a>解决办法</h4><ol><li><p>只要在用的时候创建新实例，不用static修饰。</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line>public static Date parse(String strDate) throws ParseException&#123;</span><br><span class=line>     SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class=line>    return sdf.parse(strDate);</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>如上代码，仅在需要用到的地方创建一个新的实例，就没有线程安全问题，不过也加重了创建对象的负担，会频繁地创建和销毁对象，效率较低。</p></li><li><p>使用synchronized来SimpleDateFormat对象</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre></td><td class=code><pre><span class=line>private static SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class=line>    </span><br><span class=line>public static Date parse(String strDate) throws ParseException&#123;</span><br><span class=line>    synchronized(sdf)&#123;</span><br><span class=line>        return sdf.parse(strDate);</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>当线程较多时，当一个线程调用该方法时，其他想要调用此方法的线程就要block，多线程并发量大的时候会对性能有一定的影响。</p></li><li><p>使用ThreadLocal</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre></td><td class=code><pre><span class=line>private static ThreadLocal&lt;DateFormat&gt; threadLocal = new ThreadLocal&lt;DateFormat&gt;() &#123;</span><br><span class=line>    @Override</span><br><span class=line>    protected DateFormat initialValue() &#123;</span><br><span class=line>        return new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class=line>    &#125;</span><br><span class=line>&#125;;</span><br><span class=line>    </span><br><span class=line>public static Date parse(String dateStr) throws ParseException &#123;</span><br><span class=line>    return threadLocal.get().parse(dateStr);</span><br><span class=line>&#125;</span><br><span class=line>    </span><br></pre></td></tr></table></figure><p>使用ThreadLocal, 也是将共享变量变为独享，线程独享肯定能比方法独享在并发环境中能减少不少创建对象的开销。如果对性能要求比较高的情况下，一般推荐使用这种方法。</p></li></ol><h4 id=优化框架代码><a href=#优化框架代码 class=headerlink title=优化框架代码></a>优化框架代码</h4><p>作为框架代码必须要保证性能要求，用ThreadLocal来优化代码</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre></td><td class=code><pre><span class=line>private static ThreadLocal&lt;java.text.DateFormat&gt; threadLocal = new ThreadLocal&lt;java.text.DateFormat&gt;();</span><br><span class=line></span><br><span class=line>private static java.text.DateFormat getDateFormater(DateFormat format) &#123;</span><br><span class=line></span><br><span class=line>    java.text.DateFormat dateFormater = threadLocal.get();</span><br><span class=line></span><br><span class=line>    if (dateFormater == null) &#123;</span><br><span class=line>        dateFormater = new SimpleDateFormat(format.format);</span><br><span class=line>        threadLocal.set(dateFormater);</span><br><span class=line>    &#125;</span><br><span class=line>    return dateFormater;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>用同样的测试代码测试，结果如下</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br><span class=line>......</span><br><span class=line>Fri Mar 22 10:03:25 CST 2019</span><br></pre></td></tr></table></figure><h4 id=结语><a href=#结语 class=headerlink title=结语></a>结语</h4><p>我们要站在巨人的肩膀上来做事，如果是jdk1.8 可以使用DateTimeFormatter对象来解析或格式化日期;或直接使用Joda-Time类库来处理时间相关问题。</p><h4 id=参考><a href=#参考 class=headerlink title=参考></a>参考</h4><p><a target=_blank rel=noopener href="https://mp.weixin.qq.com/s?__biz=MzI1NDQ3MjQxNA==&mid=2247488579&idx=1&sn=938bf5c4060f5758d57bb38a3d273523&chksm=e9c5edf2deb264e41895a296a71db6363a7c24d1574d1262b2a74d464c73871ab3dfb65920e6&scene=0&xtrack=1&key=788e29d0e375da22ae1918949f053d336e5d7ab2e59ce890ecd71d5a145885fcf2722671187a039ed5b59af2d4c3850464f757906a2285995765793ba14984b93cca50a8ed3e4a4a13ecaf2a95d31b3b&ascene=1&uin=MTU2NTU1NTk1&devicetype=Windows+10&version=62060720&lang=zh_CN&pass_ticket=PfdkGv+C8N6NZrxvaV85VDtvqNFgqdfh6j143w0u0Go=">还在使用SimpleDateFormat？你的项目崩没？</a><br><a target=_blank rel=noopener href=http://www.cnblogs.com/peida/archive/2013/05/31/3070790.html>深入理解Java：SimpleDateFormat安全的时间格式化</a></p></div><footer class=post-footer><div class=post-tags><a href=/tags/java/ rel=tag># java</a> <a href=/tags/SimpleDateFormat/ rel=tag># SimpleDateFormat</a> <a href=/tags/thread/ rel=tag># thread</a></div><div class=post-nav><div class=post-nav-item><a href=/2019/02/28/git/gitlab_install/ rel=prev title="Redhat7.5 安装 使用 GitLab"><i class="fa fa-chevron-left"></i> Redhat7.5 安装 使用 GitLab</a></div><div class=post-nav-item><a href=/2019/04/21/golang/golang-install/ rel=next title="golang 环境搭建">golang 环境搭建 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments gitalk-container"></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy; 2017 – <span itemprop=copyrightYear>2025</span> <span class=with-love><i class="fa fa-user"></i> </span><span class=author itemprop=copyrightHolder>TungSing</span></div></div></footer><script src=https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=/js/comments.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/next-boot.js></script><script src=/js/pjax.js></script><script src=https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin=anonymous></script><script src=/js/third-party/search/local-search.js></script><script src=/js/third-party/fancybox.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin=anonymous><script class=next-config data-name=gitalk type=application/json>{"enable":true,"github_id":"tungSing","repo":"tungsing.github.io","client_id":"52a90bdfc66139c7ae8d","client_secret":"cf1297a36b1ca9ee630211520789e614a202d310","admin_user":"tungSing","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"60043194266745fc8a0e16ce0d14af20"}</script><script src=/js/third-party/comments/gitalk.js></script><script src=/js/third-party/photo/lazyload.js></script><script src=/js/third-party/photo/minigrid.min.js></script><script data-pjax src=/js/third-party/photo/photo.js></script></body></html>